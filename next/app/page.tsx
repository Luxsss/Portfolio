"use client";

import { useEffect, useRef } from "react";
import gsap from "gsap";
import { ScrollTrigger } from "gsap/ScrollTrigger";
import Navbar from "@/components/Navbar";
import Header from "@/components/Header";
import AboutMe from "@/components/AboutMe";
import Projects from "@/components/Projects";
import Contact from "@/components/Contact";

export default function Home() {
  const svgRefDesktop = useRef<SVGSVGElement | null>(null);
  const pathRefDesktop = useRef<SVGPathElement | null>(null);
  const svgRefMobile = useRef<SVGSVGElement | null>(null);
  const pathRefMobile = useRef<SVGPathElement | null>(null);

  useEffect(() => {
    gsap.registerPlugin(ScrollTrigger);

    // Détermine si l'affichage est mobile
    const isMobile = window.innerWidth <= 425;
    const svg = isMobile ? svgRefMobile.current : svgRefDesktop.current;
    const path = isMobile ? pathRefMobile.current : pathRefDesktop.current;
    if (!svg || !path) return;

    // Indique que stroke-dashoffset sera animé
    path.style.willChange = "stroke-dashoffset";

    // Récupère la longueur totale du tracé
    const pathLength = path.getTotalLength();

    // Initialise le tracé pour créer l’effet "draw"
    path.style.strokeDasharray = `${pathLength}`;
    path.style.strokeDashoffset = `${pathLength}`;

    // Animation avec GSAP et ScrollTrigger
    gsap.to(path, {
      strokeDashoffset: 0,
      ease: "none",
      scrollTrigger: {
        trigger: svg,
        start: "top",
        end: `+=${svg.clientHeight / 1.09}`,
        scrub: true,
      },
    });
  }, []);

  return (
    <div>
      <Navbar />
      <Header />
      <AboutMe />
      <Projects />
      <Contact />

      <svg
        ref={svgRefDesktop}
        className="olk squiggle first-svg"
        width="2150"
        height="16910"
        viewBox="0 0 2150 16910"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          ref={pathRefDesktop}
          d="M0 48.6741C13.4169 -63.1596 526.783 243.928 331.167 494.411C135.55 744.893 99.6022 1014.7 150.409 1181.92C201.217 1349.14 387.342 1630.85 693.191 1643.63C999.041 1656.41 933.784 1944.86 271.642 2381.74C-363.781 2885.23 871.5 2814.5 810.4 3118.24C749.3 3421.98 1631 3174 1883.39 3500.6C2135.78 3827.21 -701.501 3911.94 271.642 4157.23C1244.79 4402.52 1502.13 4643.76 810.4 5201C118.668 5758.25 1209.85 5215.65 1708.33 4944.32C2206.81 4672.99 2143.96 5865.62 1804.41 5682.96C1464.86 5500.3 334.618 7317.34 250.515 6416.8C166.411 5516.25 1217.66 6843.69 1649.47 7035.61C2513.54 7507.61 829.012 7499.99 596.607 7564.42C364.202 7628.86 197.109 7673.85 179.586 7849.33C162.063 8024.81 1198.92 8768.4 1206.8 8269.51C1214.67 7770.61 1743.39 8363.97 1869.81 8506.49C1996.22 8649.01 2092.13 8810.95 1913.07 8759.98C1734 8709 1691.28 8997.49 1674.63 9277.6C1657.97 9557.7 692 9311 484.932 9381.45C277.864 9451.91 52.3163 9559.32 153.428 9854.35C254.539 10149.4 1018.66 10331.2 1039.79 10104.1C1060.91 9877 1539.81 10148.3 1674.63 10462.5C1809.44 10776.7 1246.24 10330.5 1060.91 10541.8C875.591 10753.2 1039.79 11228.8 1039.79 11393.9C1039.79 11559 841.589 11597.9 775.69 11228.8C709.792 10859.8 435.011 11757.1 249.006 11751.8C63 11746.5 -298.807 12428.7 979.422 12314.2C2257.65 12199.7 2349.2 12714.1 1674.63 12507.5C1000.05 12300.8 -533.727 13004.3 253.03 12955.9C1039.79 12907.4 1328.03 12995.3 709.792 13377.6C91.5536 13760 1597.66 13500.7 1759.64 13869.7C1921.62 14238.8 966.846 14127.5 1004.57 14322.4C1042.3 14517.2 1348 14249 1407.01 14467.2C1466.01 14685.4 991.77 14558.1 1004.57 14656.3C1017.38 14754.5 1310.31 14879.1 966.846 14911.4C631.766 14942.8 368.149 15199 355.477 15211.5C355.073 15211.9 354.858 15212.3 354.614 15212.8C97.0847 15753.5 1010.58 15856.9 1163.5 15610C1316.5 15363 2244 15788.5 1864.5 15821.5C1485 15854.5 740.1 16192 1242 16157C1743.9 16122 2263.01 16370.9 800.5 16404.5C-662.011 16438.1 1686.06 16917.9 2153.5 16883"
          stroke="#CE4242"
          strokeWidth="50"
        />
      </svg>

      <svg ref={svgRefMobile} className="olk squiggle second-svg" width="2149" height="23770" viewBox="0 0 2149 23770" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path ref={pathRefMobile} d="M0 48.6744C13.42 -63.1605 526.905 243.931 331.243 494.416C135.582 744.901 99.6253 1014.71 150.444 1181.93C201.263 1349.15 387.432 1630.87 693.352 1643.65C999.272 1656.43 934 1944.88 271.705 2381.76C-363.865 2885.26 871.702 2814.53 810.588 3118.28C749.474 3422.02 1865.15 3080.79 1883.83 3500.64C1902.5 3920.5 533.128 3586.26 271.705 4157.27C10.2833 4728.29 829.171 4821.42 810.588 5201.06C792.005 5580.7 1151.26 5593.83 1649.86 5322.5C2148.46 5051.17 2150 6364 1824.5 6045C1499 5726 -112.606 6492.37 436.5 6554.5C985.606 6616.63 1217.94 6843.76 1649.86 7035.69C2514.13 7507.69 829.205 7500.07 596.746 7564.51C364.287 7628.95 110.192 7551.34 179.627 7849.42C249.063 8147.5 1199.2 8768.5 1207.08 8269.6C1214.96 7770.7 1743.79 8364.06 1870.24 8506.58C1996.69 8649.1 2090.51 8788.57 1923.5 8926.5C1756.49 9064.43 1440.11 8878.6 1675.01 9277.7C1909.92 9676.8 306.79 8944.7 580.645 9466.6C854.5 9988.5 245.038 9678 249.063 9939.5C253.089 10201 1018.9 10331.3 1040.03 10104.2C1061.16 9877.11 1540.17 10148.4 1675.01 10462.6C1809.86 10776.8 1246.53 10330.6 1061.16 10542C875.795 10753.3 1040.03 11229 1040.03 11394.1C1040.03 11559.1 893.886 11392.1 580.645 11348C267.404 11303.9 482.172 11836.6 253.089 11843.5C24.0057 11850.4 -258.484 12768.2 979.649 12314.3C2217.78 11860.4 2194.74 12992.1 1520 12785.5C845.264 12578.9 -243.94 13237.5 543 13189C1329.94 13140.5 1118.88 13487.5 500.5 13869.9C-117.882 14252.2 1598.03 13500.8 1760.05 13869.9C1922.07 14238.9 967.07 14127.7 1004.81 14322.5C1042.54 14517.4 1348.31 14249.2 1407.33 14467.4C1466.36 14685.6 748.5 14378.5 748.5 14704C748.5 15029.5 1004.81 14845.5 1095 15079.5C1185.19 15313.5 662.665 15068.8 355.082 15212.2C47.5 15355.5 1010.73 15857.2 1163.77 15610.2C1316.81 15363.2 1852.5 15624.5 1711 16106C1569.5 16587.5 381.5 17145 267 16757.5C152.5 16370 1864.93 16633 1864.93 17008C1864.93 17383 1372.5 17283.5 1651.5 17820.5C1930.5 18357.5 51.0001 17820.5 387.5 18290.5C724 18760.5 -63 18811 229 19090.5C521 19370 1630.5 18903 1300.5 19391.5C970.5 19880 770.5 20006 1520 20361.5C2269.5 20717 197.5 20773.5 159 21021C120.5 21268.5 1321 21376.5 1804 21332C2287 21287.5 1702 22107 572 22164C-558 22221 730.5 22856 1257.5 22595.5C1784.5 22335 1836 23180 997.5 23097.5C159 23015 1397.66 23693.3 2146.5 23745" stroke="#CE4242" strokeWidth="50"/>
      </svg>


    </div>
  );
}
